(()=>{var e={15:e=>{"use strict";e.exports=require("react")},47:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});const n=require("axios");var o=a.n(n),s=a(15),i=a.n(s);const r=function(e){const[t,a]=(0,s.useState)(!1),[n,r]=(0,s.useState)(""),[l,c]=(0,s.useState)(),[d,m]=(0,s.useState)("");return i().createElement("div",{className:"card"},i().createElement("div",{className:"our-card-top"},t&&i().createElement("div",{className:"our-custom-input"},i().createElement("div",{className:"our-custom-input-interior"},i().createElement("input",{onChange:e=>c(e.target.files[0]),className:"form-control form-control-sm",type:"file"}))),i().createElement("img",{src:e.photo?`/uploaded-photos/${e.photo}`:"/fallback.png",className:"card-img-top",alt:`${e.species} named ${e.name}`})),i().createElement("div",{className:"card-body"},!t&&i().createElement(i().Fragment,null,i().createElement("h4",null,e.name),i().createElement("p",{className:"text-muted small"},e.species),!e.readOnly&&i().createElement(i().Fragment,null,i().createElement("button",{onClick:()=>{a(!0),r(e.name),m(e.species),c("")},className:"btn btn-sm btn-primary"},"Edit")," ",i().createElement("button",{onClick:async()=>{o().delete(`/animal/${e.id}`),e.setAnimals(t=>t.filter(t=>t._id!=e.id))},className:"btn btn-sm btn-outline-danger"},"Delete"))),t&&i().createElement("form",{onSubmit:async function(t){t.preventDefault(),a(!1),e.setAnimals(t=>t.map(function(t){return t._id==e.id?{...t,name:n,species:d}:t}));const s=new FormData;l&&s.append("photo",l),s.append("_id",e.id),s.append("name",n),s.append("species",d);const i=await o().post("/update-animal",s,{headers:{"Content-Type":"multipart/form-data"}});i.data&&e.setAnimals(t=>t.map(function(t){return t._id==e.id?{...t,photo:i.data}:t}))}},i().createElement("div",{className:"mb-1"},i().createElement("input",{autoFocus:!0,onChange:e=>r(e.target.value),type:"text",className:"form-control form-control-sm",value:n})),i().createElement("div",{className:"mb-2"},i().createElement("input",{onChange:e=>m(e.target.value),type:"text",className:"form-control form-control-sm",value:d})),i().createElement("button",{className:"btn btn-sm btn-success"},"Save")," ",i().createElement("button",{onClick:()=>a(!1),className:"btn btn-sm btn-outline-secondary"},"Cancel"))))}},252:e=>{"use strict";e.exports=require("express")},288:e=>{"use strict";e.exports=require("sharp")},461:e=>{"use strict";e.exports=require("multer")},468:e=>{"use strict";e.exports=require("react-dom/server")},518:e=>{"use strict";e.exports=require("mongodb")},583:e=>{"use strict";e.exports=require("sanitize-html")},652:e=>{"use strict";e.exports=require("fs-extra")},928:e=>{"use strict";e.exports=require("path")}},t={};function a(n){var o=t[n];if(void 0!==o)return o.exports;var s=t[n]={exports:{}};return e[n](s,s.exports,a),s.exports}a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const{MongoClient:n,ObjectId:o}=a(518),s=a(252),i=a(461)(),r=a(583),l=a(652),c=a(288);let d;const m=a(928),p=a(15),u=a(468),b=a(47).A;l.ensureDirSync(m.join("public","uploaded-photos"));const f=s();function g(e,t,a){"string"!=typeof e.body.name&&(e.body.name=""),"string"!=typeof e.body.species&&(e.body.species=""),"string"!=typeof e.body._id&&(e.body._id=""),e.cleanData={name:r(e.body.name.trim(),{allowedTags:[],allowedAttributes:{}}),species:r(e.body.species.trim(),{allowedTags:[],allowedAttributes:{}})},a()}f.set("view engine","ejs"),f.set("views","./views"),f.use(s.static("public")),f.use(s.json()),f.use(s.urlencoded({extended:!1})),f.get("/",async(e,t)=>{const a=await d.collection("animals").find().toArray(),n=u.renderToString(p.createElement("div",{className:"container"},!a.length&&p.createElement("p",null,"There are no animals yet, the admin needs to add a few."),p.createElement("div",{className:"animal-grid mb-3"},a.map(e=>p.createElement(b,{key:e._id,name:e.name,species:e.species,photo:e.photo,id:e._id,readOnly:!0}))),p.createElement("p",null,p.createElement("a",{href:"/admin"},"Login / manage the animal listings."))));t.render("home",{generatedHTML:n})}),f.use(function(e,t,a){t.set("WWW-Authenticate","Basic realm='Our MERN App'"),"Basic YWRtaW46YWRtaW4="==e.headers.authorization?a():(console.log(e.headers.authorization),t.status(401).send("Try again"))}),f.get("/admin",(e,t)=>{t.render("admin")}),f.get("/api/animals",async(e,t)=>{const a=await d.collection("animals").find().toArray();t.json(a)}),f.post("/create-animal",i.single("photo"),g,async(e,t)=>{if(e.file){const t=`${Date.now()}.jpg`;await c(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(m.join("public","uploaded-photos",t)),e.cleanData.photo=t}console.log(e.body);const a=await d.collection("animals").insertOne(e.cleanData),n=await d.collection("animals").findOne({_id:new o(a.insertedId)});t.send(n)}),f.delete("/animal/:id",async(e,t)=>{"string"!=typeof e.params.id&&(e.params.id="");const a=await d.collection("animals").findOne({_id:new o(e.params.id)});a.photo&&l.remove(m.join("public","uploaded-photos",a.photo)),d.collection("animals").deleteOne({_id:new o(e.params.id)}),t.send("Good job")}),f.post("/update-animal",i.single("photo"),g,async(e,t)=>{if(e.file){const a=`${Date.now()}.jpg`;await c(e.file.buffer).resize(844,456).jpeg({quality:60}).toFile(m.join("public","uploaded-photos",a)),e.cleanData.photo=a;const n=await d.collection("animals").findOneAndUpdate({_id:new o(e.body._id)},{$set:e.cleanData});n.value.photo&&l.remove(m.join("public","uploaded-photos",n.value.photo)),t.send(a)}else d.collection("animals").findOneAndUpdate({_id:new o(e.body._id)},{$set:e.cleanData}),t.send(!1)}),async function(){const e=new n("mongodb://root:root@localhost:27017/AmazingMernApp?authSource=admin");await e.connect(),d=e.db(),f.listen(3e3)}()})();